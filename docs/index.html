<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ANIYA MCAT | Pro v34 (Full + Content Review)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; -webkit-tap-highlight-color: transparent; }
    .glass-card { background: white; border: 1px solid #e2e8f0; border-radius: 20px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05); }
    input { outline: none; background: transparent; border: none; }
    .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 8px; font-weight: 800; text-transform: uppercase; }
    .nav-item.active { color: #4f46e5; }
    .nav-item.inactive { color: #94a3b8; }
    .tab-btn { font-size: 9px; font-weight: 800; text-transform: uppercase; padding: 10px; border-radius: 12px; flex: 1; text-align: center; }
    .tab-btn.active { background: #4f46e5; color: white; }
    .tab-btn.inactive { background: #f1f5f9; color: #64748b; }
    .btn-link { background: #f1f5f9; color: #475569; padding: 6px 10px; border-radius: 8px; font-size: 9px; font-weight: 800; border: 1px solid #e2e8f0; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
  </style>
</head>

<body class="pb-24">
  <div id="root"></div>

  <script type="module">
    import { h, render } from 'https://esm.sh/preact';
    import { useEffect, useMemo, useRef, useState } from 'https://esm.sh/preact/hooks';
    import htm from 'https://esm.sh/htm';

    const html = htm.bind(h);

    const getLocalYMD = (date = new Date()) => {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    };

    const todayStr = getLocalYMD();
    const testDateStr = "2026-06-12";

    // Phase boundaries
    const PRACTICE_PIVOT_START = "2026-01-10";
    const PHASE2_START = "2026-03-01";
    const isSunday = (dt) => dt.getDay() === 0;

    // Normalize tag matching (handles tags with spaces like "CONTENT REVIEW")
    const norm = (s) => (s || '').toString().toUpperCase();

    // ===== Psych/Soc 86-page doc review blocks (AFTER Orgo + BC + Physics) =====
    const PS_DOC_TOTAL_PAGES = 86;
    const PS_DOC_DAYS = 14; // tweak if you want
    const PS_PAGES_PER_DAY = Math.ceil(PS_DOC_TOTAL_PAGES / PS_DOC_DAYS);

    const PS_DOC_SEQ = Array.from({ length: PS_DOC_DAYS }, (_, i) => {
      const start = i * PS_PAGES_PER_DAY + 1;
      const end = Math.min((i + 1) * PS_PAGES_PER_DAY, PS_DOC_TOTAL_PAGES);
      return { tag: "PS", text: `Psych 86pg Doc: Pages ${start}â€“${end} (Review + make error cards)` };
    });

    // Seed your Anki log (only if storage is empty OR it contains only a blank placeholder row)
    const ANKI_SEED = [
      { id: 1700, date: '2026-01-07', count: 300 },
      { id: 1699, date: '2026-01-06', count: 68  },
      { id: 1698, date: '2026-01-05', count: 163 },
      { id: 1697, date: '2026-01-04', count: 152 },
      { id: 1696, date: '2026-01-03', count: 150 },
      { id: 1695, date: '2026-01-02', count: 165 },
      { id: 1694, date: '2026-01-01', count: 103 },
      { id: 1693, date: '2025-12-30', count: 135 },
      { id: 1692, date: '2025-12-29', count: 299 }
    ];

    const loadAnki = () => {
      const raw = localStorage.getItem('aniya_v34_anki');
      if (!raw) return ANKI_SEED;

      try {
        const parsed = JSON.parse(raw);
        const isBlankPlaceholder =
          Array.isArray(parsed) &&
          parsed.length === 1 &&
          parsed[0] &&
          parsed[0].count === 0 &&
          parsed[0].date === todayStr;

        return isBlankPlaceholder ? ANKI_SEED : parsed;
      } catch {
        return ANKI_SEED;
      }
    };

    const App = () => {
      const [activeTab, setActiveTab] = useState('home');
      const [plannerTab, setPlannerTab] = useState('content');
      const chartRef = useRef(null);
      const chartInstance = useRef(null);

      const [done, setDone] = useState(() => JSON.parse(localStorage.getItem('aniya_v34_done')) || {});
      const [anki, setAnki] = useState(() => loadAnki());
      const [accuracy, setAccuracy] = useState(() => JSON.parse(localStorage.getItem('aniya_v34_acc')) || []);
      const [flScores, setFlScores] = useState(() => JSON.parse(localStorage.getItem('aniya_v34_fl')) || [
        { id: 'diag', date: '2025-12-21', source: 'Diagnostic', cp: 120, cars: 122, bb: 122, ps: 118 }
      ]);

      useEffect(() => {
        localStorage.setItem('aniya_v34_done', JSON.stringify(done));
        localStorage.setItem('aniya_v34_anki', JSON.stringify(anki));
        localStorage.setItem('aniya_v34_fl', JSON.stringify(flScores));
        localStorage.setItem('aniya_v34_acc', JSON.stringify(accuracy));
        if (activeTab === 'scores') renderChart();
      }, [done, anki, flScores, accuracy, activeTab]);

      // Historical mapping
      const HISTORICAL_PLAN = {
        "2025-12-29": [{ tag: 'GC', text: 'Ch 6: Chemical Equilibrium' }, { tag: 'CARS', text: '2 Bootcamp Passages' }],
        "2025-12-30": [{ tag: 'GC', text: 'Ch 7: Thermochemistry' }, { tag: 'CARS', text: '2 Bootcamp Passages' }],
        "2025-12-31": [{ tag: 'REST', text: 'RECOVERY DAY' }],
        "2026-01-01": [{ tag: 'GC', text: 'Ch 8: Gas Phase + Ch 9: Solutions' }, { tag: 'CARS', text: '2 Bootcamp Passages' }],
        "2026-01-02": [{ tag: 'GC', text: 'Ch 10: Acids and Bases' }, { tag: 'CARS', text: '2 Bootcamp Passages' }],
        "2026-01-03": [{ tag: 'GC', text: 'Ch 11/12: Redox' }, { tag: 'CARS', text: '2 Bootcamp Passages' }],
        "2026-01-04": [{ tag: 'REST', text: 'â˜€ï¸ SUNDAY REST (Optional Anki)' }]
      };

      // Full Lengths
      const FL_PLAN = {
        "2026-03-16": [{ tag: "AAMC", text: "Full Length #1" }],
        "2026-03-17": [{ tag: "REVIEW", text: "FL #1 Review" }],

        "2026-03-30": [{ tag: "AAMC", text: "Full Length #2" }],
        "2026-03-31": [{ tag: "REVIEW", text: "FL #2 Review" }],

        "2026-04-13": [{ tag: "AAMC", text: "Full Length #3" }],
        "2026-04-14": [{ tag: "REVIEW", text: "FL #3 Review" }],

        "2026-04-27": [{ tag: "AAMC", text: "Full Length #4" }],
        "2026-04-28": [{ tag: "REVIEW", text: "FL #4 Review" }],

        "2026-05-11": [{ tag: "AAMC", text: "Full Length #5" }],
        "2026-05-12": [{ tag: "REVIEW", text: "FL #5 Review" }],

        "2026-05-25": [{ tag: "AAMC", text: "Full Length #6" }],
        "2026-05-26": [{ tag: "REVIEW", text: "FL #6 Review" }],

        "2026-06-01": [{ tag: "AAMC", text: "Full Length #7 (Optional)" }],
        "2026-06-02": [{ tag: "REVIEW", text: "FL #7 Review (Optional)" }]
      };

      // ===== CONTENT SEQUENCE (UPDATED) =====
      // Removed "JW alongside Orgo". Orgo is Orgo only.
      const CONTENT_SEQ = [
        { tag: 'ORGO', text: 'Orgo 1' },
        { tag: 'ORGO', text: 'Orgo 2' },
        { tag: 'ORGO', text: 'Orgo 3/4' },
        { tag: 'ORGO', text: 'Orgo 5' },
        { tag: 'ORGO', text: 'Orgo 6' },
        { tag: 'ORGO', text: 'Resonance' },
        { tag: 'ORGO', text: 'Orgo 7' },
        { tag: 'ORGO', text: 'Orgo 8/9' },
        { tag: 'ORGO', text: 'Orgo 10' },

        // Biochem
        { tag: 'BC', text: 'Ch 1: Amino Acids (P1)' }, { tag: 'BC', text: 'Ch 1: Amino Acids (P2)' },
        { tag: 'BC', text: 'Ch 2: Enzymes (P1)' },     { tag: 'BC', text: 'Ch 2: Enzymes (P2)' },
        { tag: 'BC', text: 'Ch 3: Nonenzymatic Proteins' },
        { tag: 'BC', text: 'Ch 4: Carbohydrates' },
        { tag: 'BC', text: 'Ch 5: Lipids' },
        { tag: 'BC', text: 'Ch 6: DNA' },
        { tag: 'BC', text: 'Ch 7: RNA' },
        { tag: 'BC', text: 'Ch 8: Bio Membranes' },
        { tag: 'BC', text: 'Ch 9: Carb Metabolism 1 (P1)' },
        { tag: 'BC', text: 'Ch 9: Carb Metabolism 1 (P2)' },
        { tag: 'BC', text: 'Ch 10: Carb Metabolism 2 (P1)' },
        { tag: 'BC', text: 'Ch 10: Carb Metabolism 2 (P2)' },
        { tag: 'BC', text: 'Ch 11: Fatty Acids' },
        { tag: 'BC', text: 'Ch 12: Bioenergetics' },

        // Physics
        { tag: 'EK', text: 'Physics Lec 1' },
        { tag: 'EK', text: 'Physics Lec 2' },
        { tag: 'EK', text: 'Physics Lec 3' },
        { tag: 'EK', text: 'Physics Lec 4' },
        { tag: 'EK', text: 'Physics Lec 5' },
        { tag: 'EK', text: 'Physics Lec 6' },
        { tag: 'EK', text: 'Physics Lec 7' },
        { tag: 'EK', text: 'Physics Lec 8' },
        { tag: 'EK', text: 'Physics Lec 9' },
      ];

      // Extend with PS doc later
      const CONTENT_SEQ_EXTENDED = [
        ...CONTENT_SEQ,
        ...PS_DOC_SEQ
      ];

      // Phase 1 daily stack: PRACTICE -> REVIEW -> CONTENT REVIEW -> CARS
      const phase1Tasks = (d, contentText = null) => {
        const tasks = [];
        tasks.push({ id: `p-${d}`, tag: 'PRACTICE', text: 'Timed Mixed Set (15â€“20 Q) â€” UWorld rotation (pick 1 subject focus)' });
        tasks.push({ id: `rev-${d}`, tag: 'REVIEW', text: 'Review misses + guesses â†’ ChatGPT patch â†’ make 3â€“8 â€œerror cardsâ€' });
        tasks.push({
          id: `cr-${d}`,
          tag: 'CONTENT REVIEW',
          text: contentText ? contentText : 'From misses: 1 weak concept only'
        });
        tasks.push({ id: `c-${d}`, tag: 'CARS', text: '2 Passages (timed)' });
        return tasks;
      };

      const fullSchedule = useMemo(() => {
        let dt = new Date("2025-12-29T12:00:00");
        const plan = {};
        const dates = [];
        let seqIdx = 0;

        while (getLocalYMD(dt) <= testDateStr) {
          const d = getLocalYMD(dt);
          dates.push(d);

          if (HISTORICAL_PLAN[d]) {
            plan[d] = HISTORICAL_PLAN[d].map((t, i) => ({ id: `hist-${d}-${i}`, ...t }));
          } else if (d === '2026-01-05') {
            plan[d] = [
              { id: 't-0105', tag: 'JW', text: 'JW Gen Chem Discretes (legacy)' },
              { id: `c-${d}`, tag: 'CARS', text: '2 Bootcamp Passages' }
            ];
          } else if (FL_PLAN[d]) {
            plan[d] = FL_PLAN[d].map((t, i) => ({ id: `fl-${d}-${i}`, ...t }));
          } else if (isSunday(dt)) {
            plan[d] = [{ id: `rest-${d}`, tag: 'REST', text: 'â˜€ï¸ SUNDAY REST (Optional light Anki)' }];
          } else if (d === testDateStr) {
            plan[d] = [{ id: 'test', tag: 'AAMC', text: 'ðŸš€ TEST DAY' }];
          } else if (d >= PRACTICE_PIVOT_START && d < PHASE2_START) {
            const anchor = CONTENT_SEQ_EXTENDED[seqIdx]
              ? `${CONTENT_SEQ_EXTENDED[seqIdx].tag}: ${CONTENT_SEQ_EXTENDED[seqIdx].text}`
              : null;
            plan[d] = phase1Tasks(d, anchor);
            if (CONTENT_SEQ_EXTENDED[seqIdx]) seqIdx++;
          } else {
            plan[d] = [];
            if (CONTENT_SEQ_EXTENDED[seqIdx]) {
              plan[d].push({ id: `s-${seqIdx}`, ...CONTENT_SEQ_EXTENDED[seqIdx] });
              seqIdx++;
            } else {
              plan[d].push({ id: `u-${d}`, tag: 'PRACTICE', text: 'UWorld Rotation' });
            }
            plan[d].push({ id: `c-${d}`, tag: 'CARS', text: '2 Passages (timed)' });
          }

          dt.setDate(dt.getDate() + 1);
        }

        return { plan, dates };
      }, []);

      const renderChart = () => {
        if (!chartRef.current) return;
        if (chartInstance.current) chartInstance.current.destroy();
        const sorted = [...flScores].sort((a,b) => new Date(a.date) - new Date(b.date));
        chartInstance.current = new Chart(chartRef.current, {
          type: 'line',
          data: {
            labels: sorted.map(s => s.date.slice(5)),
            datasets: [
              { label: 'C/P', data: sorted.map(s => s.cp), borderColor: '#ef4444', tension: 0.3, pointBackgroundColor: '#ef4444' },
              { label: 'CARS', data: sorted.map(s => s.cars), borderColor: '#f59e0b', tension: 0.3, pointBackgroundColor: '#f59e0b' },
              { label: 'B/B', data: sorted.map(s => s.bb), borderColor: '#10b981', tension: 0.3, pointBackgroundColor: '#10b981' },
              { label: 'P/S', data: sorted.map(s => s.ps), borderColor: '#8b5cf6', tension: 0.3, pointBackgroundColor: '#8b5cf6' }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { boxWidth: 8, font: { size: 10, weight: 'bold' } } } },
            scales: { y: { min: 118, max: 132, ticks: { stepSize: 1 } } }
          }
        });
      };

      const Icon = (t) => {
        const p = {
          home: "M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6",
          plan: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
          anki: "M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10",
          scores: "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",
          acc: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
        };
        return html`<svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d=${p[t]} stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
      };

      const tagBorder = (tag) => {
        const T = norm(tag);
        if (T === 'BC' || T === 'JW') return 'border-green-500';
        if (T === 'CARS') return 'border-amber-500';
        if (T === 'REST') return 'border-yellow-400';
        if (T === 'PRACTICE') return 'border-indigo-500';
        if (T === 'REVIEW') return 'border-slate-500';
        if (T === 'CONTENT REVIEW') return 'border-emerald-500';
        if (T === 'AAMC') return 'border-indigo-600';
        if (T === 'PS') return 'border-violet-500';
        if (T === 'ORGO') return 'border-teal-500';
        if (T === 'EK') return 'border-slate-400';
        if (T === 'GC') return 'border-green-500';
        return 'border-indigo-500';
      };

      const tagColor = (tag) => {
        const T = norm(tag);
        if (T === 'BC' || T === 'JW') return 'text-green-500';
        if (T === 'CARS') return 'text-amber-500';
        if (T === 'REST') return 'text-yellow-500';
        if (T === 'PRACTICE') return 'text-indigo-500';
        if (T === 'REVIEW') return 'text-slate-500';
        if (T === 'CONTENT REVIEW') return 'text-emerald-600';
        if (T === 'AAMC') return 'text-indigo-600';
        if (T === 'PS') return 'text-violet-600';
        if (T === 'ORGO') return 'text-teal-600';
        if (T === 'EK') return 'text-slate-500';
        if (T === 'GC') return 'text-green-500';
        return 'text-indigo-400';
      };

      const latestFLTotal = () => {
        if (!flScores || flScores.length === 0) return '--';
        const s = flScores[0];
        return (Number(s.cp)||0) + (Number(s.cars)||0) + (Number(s.bb)||0) + (Number(s.ps)||0);
      };

      return html`
        <div class="min-h-screen">
          <header class="p-6 pb-2 flex justify-between items-center bg-white sticky top-0 z-10 border-b border-slate-50">
            <div class="flex flex-col">
              <h1 class="text-xl font-black italic text-indigo-600 leading-tight">ANIYA MCAT</h1>
              <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">${todayStr}</p>
            </div>
            <div class="flex space-x-1">
              <a href="https://jackwestin.com" target="_blank" class="btn-link">JW</a>
              <a href="https://app.bootcamp.com/auth?#/signin?redirectTo=/mcat" target="_blank" class="btn-link">CARS</a>
            </div>
          </header>

          <main class="p-6 space-y-6">
            ${activeTab === 'home' && html`
              <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                  <div class="glass-card p-5">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Anki Sync</p>
                    <input type="number" class="text-3xl font-black text-indigo-600 w-full"
                      value=${anki.find(a=>a.date===todayStr)?.count || 0}
                      onInput=${e => {
                        const val = Number(e.target.value);
                        const idx = anki.findIndex(a => a.date === todayStr);
                        if (idx !== -1) {
                          let n=[...anki]; n[idx].count=val; setAnki(n);
                        } else {
                          setAnki([{id:Date.now(), date:todayStr, count:val}, ...anki]);
                        }
                      }} />
                    <p class="text-[10px] font-bold text-slate-400 mt-2">Goal: 100â€“150/day (error cards + formulas).</p>
                  </div>
                  <div class="glass-card p-5 bg-indigo-600 text-white shadow-lg">
                    <p class="text-[9px] font-black opacity-60 uppercase">Latest FL</p>
                    <p class="text-3xl font-black">${latestFLTotal()}</p>
                  </div>
                </div>

                <div class="space-y-3">
                  <h3 class="text-xs font-black uppercase tracking-widest text-slate-400">Current Tasks</h3>
                  ${(fullSchedule.plan[todayStr] || []).map(t => html`
                    <div onClick=${() => setDone({...done, [t.id]: !done[t.id]})} class="glass-card p-4 flex items-center border-l-4 ${tagBorder(t.tag)}">
                      <div class="flex-1">
                        <p class="text-[9px] font-black uppercase ${tagColor(t.tag)}">${t.tag}</p>
                        <p class=${`text-sm font-bold ${done[t.id]?'line-through text-slate-300':''}`}>${t.text}</p>
                      </div>
                      <div class=${`w-5 h-5 rounded-full border-2 ${done[t.id]?'bg-indigo-500 border-indigo-500':'border-slate-100'}`}></div>
                    </div>
                  `)}
                </div>
              </div>
            `}

            ${activeTab === 'plan' && html`
              <div class="space-y-4">
                <div class="flex space-x-2">
                  <button onClick=${() => setPlannerTab('content')} class=${`tab-btn ${plannerTab==='content'?'active':'inactive'}`}>Content</button>
                  <button onClick=${() => setPlannerTab('practice')} class=${`tab-btn ${plannerTab==='practice'?'active':'inactive'}`}>Practice</button>
                </div>
                <div class="glass-card max-h-[60vh] overflow-y-auto no-scrollbar">
                  ${fullSchedule.dates
                    .filter(d => plannerTab === 'content' ? d < PHASE2_START : d >= PHASE2_START)
                    .map(d => html`
                    <div class=${`p-4 border-b border-slate-50 flex space-x-4 ${d === todayStr ? 'bg-indigo-50 border-l-4 border-l-indigo-600' : ''}`}>
                      <div class="text-[9px] font-black text-slate-400 w-12 pt-1">${d.slice(5)}</div>
                      <div class="flex-1 space-y-2">
                        ${(fullSchedule.plan[d] || []).map(t => html`
                          <div class="flex items-center justify-between">
                            <span class=${`text-xs font-bold ${done[t.id]?'line-through text-slate-300':''}`}>${t.tag}: ${t.text}</span>
                            <div onClick=${() => setDone({...done, [t.id]: !done[t.id]})} class=${`w-3 h-3 rounded-sm border ${done[t.id]?'bg-indigo-500 border-indigo-500':'border-slate-200'}`}></div>
                          </div>
                        `)}
                      </div>
                    </div>
                  `)}
                </div>
              </div>
            `}

            ${activeTab === 'anki' && html`
              <div class="space-y-4">
                <div class="flex justify-between items-center mb-2">
                  <h2 class="font-black uppercase text-sm">Anki Log</h2>
                  <button onClick=${() => setAnki([{id: Date.now(), date: todayStr, count: 0}, ...anki])} class="bg-indigo-600 text-white px-3 py-1 rounded-lg text-[10px] font-black uppercase shadow-sm">
                    + Manual Entry
                  </button>
                </div>
                <div class="space-y-3">
                  ${anki.map(a => html`
                    <div class="glass-card p-4 flex flex-col space-y-3">
                      <div class="flex justify-between items-center">
                        <input type="date" class="text-[10px] font-black text-indigo-500 uppercase border-b border-indigo-50" value=${a.date}
                          onInput=${e => setAnki(anki.map(x => x.id === a.id ? {...x, date: e.target.value} : x))} />
                        <button onClick=${() => setAnki(anki.filter(x => x.id !== a.id))} class="text-red-300 text-xs">âœ•</button>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="font-bold text-sm">Cards Reviewed</span>
                        <input type="number" class="w-20 text-right font-black text-indigo-600 text-lg border-b-2 border-slate-100" value=${a.count}
                          onInput=${e => setAnki(anki.map(x => x.id === a.id ? {...x, count: Number(e.target.value)} : x))} />
                      </div>
                    </div>
                  `)}
                </div>
              </div>
            `}

            ${activeTab === 'scores' && html`
              <div class="space-y-4">
                <div class="glass-card p-4 h-64"><canvas ref=${chartRef}></canvas></div>
                <button onClick=${() => setFlScores([{id:Date.now(), date:todayStr, source:'New FL', cp:125, cars:125, bb:125, ps:125}, ...flScores])}
                  class="w-full bg-indigo-600 text-white p-4 rounded-2xl font-black text-xs uppercase shadow-lg">+ Add FL Result</button>
                ${flScores.map(s => html`
                  <div class="glass-card p-4 space-y-3">
                    <div class="flex justify-between">
                      <input class="font-black text-xs uppercase" value=${s.source}
                        onInput=${e => setFlScores(flScores.map(x=>x.id===s.id?{...x, source:e.target.value}:x))} />
                      <button onClick=${() => setFlScores(flScores.filter(x=>x.id!==s.id))}
                        class="text-red-400 font-bold text-[10px]">DELETE</button>
                    </div>
                    <div class="grid grid-cols-4 gap-2">
                      ${['cp','cars','bb','ps'].map(f => html`
                        <div class="text-center">
                          <p class="text-[8px] font-bold uppercase text-slate-300 mb-1">${f}</p>
                          <input type="number" class="font-black w-full text-center border-b border-slate-100" value=${s[f]}
                            onInput=${e => setFlScores(flScores.map(x=>x.id===s.id?{...x, [f]:Number(e.target.value)}:x))} />
                        </div>
                      `)}
                    </div>
                  </div>
                `)}
              </div>
            `}

            ${activeTab === 'acc' && html`
              <div class="space-y-4">
                <button onClick=${() => setAccuracy([{id:Date.now(), p:'UWorld', s:'Topic', c:0, t:0}, ...accuracy])}
                  class="w-full bg-indigo-600 text-white p-4 rounded-2xl font-black text-xs uppercase">+ New Log</button>
                ${accuracy.map(r => html`
                  <div class="glass-card p-4 flex items-center justify-between">
                    <div class="flex-1">
                      <input class="text-[9px] font-black text-indigo-500 uppercase" value=${r.p}
                        onInput=${e => setAccuracy(accuracy.map(x=>x.id===r.id?{...x, p:e.target.value}:x))} />
                      <input class="text-sm font-bold block w-full" value=${r.s}
                        onInput=${e => setAccuracy(accuracy.map(x=>x.id===r.id?{...x, s:e.target.value}:x))} />
                    </div>
                    <div class="flex items-center space-x-2">
                      <input type="number" class="w-8 text-center font-black border-b" value=${r.c}
                        onInput=${e => setAccuracy(accuracy.map(x=>x.id===r.id?{...x, c:Number(e.target.value)}:x))} />
                      <span class="text-slate-300">/</span>
                      <input type="number" class="w-8 text-center font-black border-b" value=${r.t}
                        onInput=${e => setAccuracy(accuracy.map(x=>x.id===r.id?{...x, t:Number(e.target.value)}:x))} />
                      <button onClick=${() => setAccuracy(accuracy.filter(x => x.id !== r.id))} class="ml-2 text-red-300">âœ•</button>
                    </div>
                  </div>
                `)}
              </div>
            `}
          </main>

          <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 h-20 flex px-2 z-50">
            ${['home','plan','anki','scores','acc'].map(t => html`
              <button onClick=${() => setActiveTab(t)} class=${`nav-item ${activeTab===t?'active':'inactive'}`}>
                ${Icon(t)} <span>${t}</span>
              </button>
            `)}
          </nav>
        </div>
      `;
    };

    render(html`<${App} />`, document.getElementById('root'));
  </script>
</body>
</html>
